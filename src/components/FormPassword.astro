---
import TextLink from "@sections/TextLink.astro";
import BtnColor from "@components/BtnColor.astro";
import BackgroundColors from "@components/BackgroundColors.astro";
---

<form-password>
    <h1>Restablecer contraseña</h1>

    <BackgroundColors type="change_password">
        <form id="form-email">
            <div id="forgot_password">
                <p>Ingrese su correo para restablecer su contraseña:</p>
                <input
                    type="email"
                    name="email"
                    id="email"
                    placeholder="nombre@gmail.com"
                />
            </div>
            <div id="change_password">
                <p>Se enviará un código de verificación al correo:</p>
            </div>
            <p id="error">El correo no se encuentra registrado</p>
            <span>
                <BtnColor text="CONFIRMAR" type="form" />
            </span>
        </form>
    </BackgroundColors>

    <TextLink
        href="/signin"
        text="¿No tiene una cuenta?"
        textN="Crear cuenta"
    />
</form-password>

<style>
    form-password {
        display: flex;
        flex-direction: column;

        width: 100%;
        min-height: 90dvh;

        h1 {
            text-align: center;
            margin-top: 9.5rem;
            margin-bottom: 2.5rem;
        }

        form {
            display: flex;
            flex-direction: column;

            width: 100%;
            height: auto;

            z-index: 1;
            padding: 20px;
            border-radius: 8px;

            background-color: var(--bg-color-dark);

            html.light & {
                background-color: var(--bg-color-light);
            }

            div {
                display: none;

                flex-direction: column;
                gap: 1rem;

                padding-bottom: 2rem;

                p {
                    text-align: center;
                    letter-spacing: 0.5px;
                    font-size: 1.2rem;
                }

                input {
                    border: none;
                    width: 100%;
                    padding: 8px;

                    &:focus {
                        outline: none;
                    }

                    html.light & {
                        background-color: #c9c9c9;
                    }
                }
            }

            p#error{
                text-align: center;
                opacity: 0;
                color: var(--red-700);

                html.light & {
                    color: var(--red);
                }
            }

            span {
                width: 100%;
                display: flex;
                margin: 2rem auto 0;
            }
        }
    }
    @media (width < 525px) {
        form-password {
            h1 {
                margin-top: 4rem;
                margin-bottom: 4.5rem;
            }
        }
    }
</style>

<script>
    import {
        renderChangePassword,
        renderForgotPassword,
    } from "@scripts/password/renderForms";
    import { enableSendEmail } from "@scripts/password/handlers";

    class FormPassword extends HTMLElement {
        constructor() {
            super();
        }
        connectedCallback() {
            const cacheEmailUser = JSON.parse(
                sessionStorage.getItem("data-user"),
            );
            const emailUser = sessionStorage.getItem("email-user");

            if (cacheEmailUser) renderChangePassword(cacheEmailUser.email, this);
            else if (emailUser) renderChangePassword(emailUser, this);
            else renderForgotPassword(this);

            enableSendEmail(this);
        }
    }

    customElements.define("form-password", FormPassword);
</script>
